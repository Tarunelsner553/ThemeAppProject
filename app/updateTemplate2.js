// Example response JSON for processing
const jsonResponse = {
  asset: {
    key: "templates/index.json",
    public_url: null,
    value:
      '{\n  "sections": {\n    "first": {\n      "type": "image-banner",\n      "blocks": {\n        "heading_mAYBMX": {\n          "type": "heading",\n          "settings": {\n            "heading": "Image banner",\n            "heading_size": "h1"\n          }\n        },\n        "text_amJ9y3": {\n          "type": "text",\n          "settings": {\n            "text": "Give customers details about the banner image(s) or content on the template.",\n            "text_style": "body"\n          }\n        },\n        "buttons_fMHKiM": {\n          "type": "buttons",\n          "settings": {\n            "button_label_1": "Button label",\n            "button_link_1": "",\n            "button_style_secondary_1": false,\n            "button_label_2": "Button label",\n            "button_link_2": "",\n            "button_style_secondary_2": false\n          }\n        }\n      },\n      "block_order": [\n        "heading_mAYBMX",\n        "text_amJ9y3",\n        "buttons_fMHKiM"\n      ],\n      "settings": {\n        "image": "shopify:\\/\\/shop_images\\/theme_cover_image.jpg",\n        "image_overlay_opacity": 0,\n        "image_height": "medium",\n        "desktop_content_position": "middle-center",\n        "show_text_box": true,\n        "desktop_content_alignment": "center",\n        "color_scheme": "background-1",\n        "image_behavior": "none",\n        "mobile_content_alignment": "center",\n        "stack_images_on_mobile": true,\n        "show_text_below": true\n      }\n    },\n    "second": {\n      "type": "image-banner",\n      "blocks": {\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-0": {\n          "type": "heading",\n          "settings": {\n            "heading": "Checkout UI Test",\n            "heading_size": "h1"\n          }\n        },\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-1": {\n          "type": "text",\n          "settings": {\n            "text": "A theme and populated test store by Shopify to help you test commerce primitives.",\n            "text_style": "body"\n          }\n        },\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-2": {\n          "type": "buttons",\n          "settings": {\n            "button_label_1": "Shop products",\n            "button_link_1": "shopify:\\/\\/collections\\/all",\n            "button_style_secondary_1": false,\n            "button_label_2": "",\n            "button_link_2": "",\n            "button_style_secondary_2": false\n          }\n        }\n      },\n      "block_order": [\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-0",\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-1",\n        "template--18309637636369__6a3bb789-ce10-45f5-ae67-e2063ef8c76b-168016437761699a6e-2"\n      ],\n      "custom_css": [\n\n      ],\n      "settings": {\n        "image": "shopify:\\/\\/shop_images\\/person-stands-on-rocks-poking-out-of-the-ocean-shoreline.jpg",\n        "image_overlay_opacity": 0,\n        "image_height": "medium",\n        "desktop_content_position": "middle-left",\n        "show_text_box": true,\n        "desktop_content_alignment": "left",\n        "color_scheme": "background-1",\n        "image_behavior": "none",\n        "mobile_content_alignment": "center",\n        "stack_images_on_mobile": true,\n        "show_text_below": true\n      }\n    },\n    "featured_collection": {\n      "type": "featured-collection",\n      "settings": {\n        "title": "<strong>Featured products<\\/strong>",\n        "heading_size": "h1",\n        "description": "",\n        "show_description": false,\n        "description_style": "body",\n        "collection": "automated-collection",\n        "products_to_show": 10,\n        "columns_desktop": 3,\n        "full_width": false,\n        "show_view_all": false,\n        "view_all_style": "solid",\n        "enable_desktop_slider": true,\n        "color_scheme": "background-1",\n        "image_ratio": "portrait",\n        "show_secondary_image": true,\n        "show_vendor": false,\n        "show_rating": false,\n        "enable_quick_add": false,\n        "columns_mobile": "2",\n        "swipe_on_mobile": false,\n        "padding_top": 36,\n        "padding_bottom": 36\n      }\n    },\n    "f1552b18-6017-4231-810d-74e61da22c37": {\n      "type": "image-with-text",\n      "blocks": {\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-0": {\n          "type": "heading",\n          "settings": {\n            "heading": "Stay hydrated",\n            "heading_size": "h1"\n          }\n        },\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-1": {\n          "type": "text",\n          "settings": {\n            "text": "<p>Try our wax subscription so you can fly high, but never dry.<\\/p>",\n            "text_style": "body"\n          }\n        },\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-2": {\n          "type": "button",\n          "settings": {\n            "button_label": "Get waxy now",\n            "button_link": "shopify:\\/\\/products\\/selling-plans-ski-wax"\n          }\n        }\n      },\n      "block_order": [\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-0",\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-1",\n        "template--18309637636369__f1552b18-6017-4231-810d-74e61da22c37-1680164422d7fb2efc-2"\n      ],\n      "settings": {\n        "image": "shopify:\\/\\/shop_images\\/theme_cover_image.jpg",\n        "height": "adapt",\n        "desktop_image_width": "medium",\n        "layout": "image_first",\n        "desktop_content_position": "middle",\n        "desktop_content_alignment": "left",\n        "content_layout": "no-overlap",\n        "color_scheme": "accent-1",\n        "image_behavior": "none",\n        "mobile_content_alignment": "left",\n        "padding_top": 60,\n        "padding_bottom": 60\n      }\n    },\n    "38cdf60f-e431-43b5-aac3-7e6215447d67": {\n      "type": "collection-list",\n      "blocks": {\n        "template--18309637636369__38cdf60f-e431-43b5-aac3-7e6215447d67-1680164898782d94ce-0": {\n          "type": "featured_collection",\n          "settings": {\n            "collection": "hydrogen"\n          }\n        },\n        "template--18309637636369__38cdf60f-e431-43b5-aac3-7e6215447d67-1680164898782d94ce-1": {\n          "type": "featured_collection",\n          "settings": {\n            "collection": "automated-collection"\n          }\n        }\n      },\n      "block_order": [\n        "template--18309637636369__38cdf60f-e431-43b5-aac3-7e6215447d67-1680164898782d94ce-0",\n        "template--18309637636369__38cdf60f-e431-43b5-aac3-7e6215447d67-1680164898782d94ce-1"\n      ],\n      "settings": {\n        "title": "<strong>Collections<\\/strong>",\n        "heading_size": "h1",\n        "image_ratio": "portrait",\n        "columns_desktop": 2,\n        "color_scheme": "background-1",\n        "show_view_all": false,\n        "columns_mobile": "1",\n        "swipe_on_mobile": false,\n        "padding_top": 36,\n        "padding_bottom": 36\n      }\n    }\n  },\n  "order": [\n    "first",\n    "second",\n    "featured_collection",\n    "f1552b18-6017-4231-810d-74e61da22c37",\n    "38cdf60f-e431-43b5-aac3-7e6215447d67"\n  ]\n}\n',
  },
};

function processAndFormatJson(jsonResponse) {
  try {
    // Parse the 'value' field from the JSON response
    const parsedData = JSON.parse(jsonResponse.asset.value);

    // Object to store section type counts
    const typeCounts = {};
    const newSections = {};
    const newOrder = [];

    // Process each section
    Object.keys(parsedData.sections).forEach((sectionKey, index) => {
      const section = parsedData.sections[sectionKey];
      const { type } = section;

      // Increment section type count
      typeCounts[type] = (typeCounts[type] || 0) + 1;

      // Rename section key if there are multiple sections of the same type
      const newSectionKey = `${type}-${typeCounts[type]}`;
      newSections[newSectionKey] = section;

      // Update the order array with the new section key
      const orderIndex = parsedData.order.indexOf(sectionKey);
      if (orderIndex !== -1) {
        newOrder[orderIndex] = newSectionKey;
      }
    });

    // Update the sections and order in the parsed data
    parsedData.sections = newSections;
    parsedData.order = newOrder;

    // Convert processed data back to JSON string with proper escaping
    const formattedJsonString = JSON.stringify(parsedData, null, 2)
      .replace(/\n/g, "\\n")
      .replace(/\r/g, "\\r")
      .replace(/\t/g, "\\t");

    return formattedJsonString;
  } catch (error) {
    console.error("Error processing and formatting JSON:", error);
    return null;
  }
}

// Example usage
const formattedJsonString = processAndFormatJson(jsonResponse);
console.log("Formatted JSON String:", formattedJsonString);
